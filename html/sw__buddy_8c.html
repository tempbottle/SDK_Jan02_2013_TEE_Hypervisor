<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>sw_buddy.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6aeebb853ebd8c514e6186653c592c82.html">otzone</a></li><li class="navelem"><a class="el" href="dir_fb44076c8b62c63869cf8a830933e50d.html">src</a></li><li class="navelem"><a class="el" href="dir_2d945ebfca6299adda500e2943a81344.html">lib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sw_buddy.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="sw__types_8h_source.html">sw_types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__debug_8h_source.html">sw_debug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__list_8h_source.html">sw_list.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__buddy_8h_source.html">sw_buddy.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__mem__functions_8h_source.html">sw_mem_functions.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cpu_8h_source.html">cpu.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="global_8h_source.html">global.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="elf__loader_8h_source.html">elf_loader.h</a>&gt;</code><br/>
</div>
<p><a href="sw__buddy_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a070d2ce7b6bb7e5c05602aa8c308d0c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>&#160;&#160;&#160;((void *)0)</td></tr>
<tr class="separator:a070d2ce7b6bb7e5c05602aa8c308d0c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a152fc5203b90b1cff03b7b78579b8f52"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a152fc5203b90b1cff03b7b78579b8f52">_DEBUG</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a152fc5203b90b1cff03b7b78579b8f52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae35af79feeae0236e432622607a87c25"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(fmt,...)</td></tr>
<tr class="separator:ae35af79feeae0236e432622607a87c25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1e5ae50fc432ac8912714f90b07ad75"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#ad1e5ae50fc432ac8912714f90b07ad75">IS_POW_TWO</a>(x)&#160;&#160;&#160;(x &amp;&amp; !(x &amp; (x - 1)))</td></tr>
<tr class="separator:ad1e5ae50fc432ac8912714f90b07ad75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac28cae12b6e530686c74ba708a365d13"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#ac28cae12b6e530686c74ba708a365d13">buddy_init</a> (int index, void *<a class="el" href="sw__buddy_8h.html#a936aeca6c70ac3b4d5e4993539283e3e">heap_start</a>, unsigned int <a class="el" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a>)</td></tr>
<tr class="separator:ac28cae12b6e530686c74ba708a365d13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d5bf0284b0f6760b507efa1141b88b7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a4d5bf0284b0f6760b507efa1141b88b7">sw_buddy_malloc</a> (int index, unsigned int size)</td></tr>
<tr class="separator:a4d5bf0284b0f6760b507efa1141b88b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af960db9027608582febfaaae7402becd"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#af960db9027608582febfaaae7402becd">buddy_zalloc</a> (unsigned int size)</td></tr>
<tr class="separator:af960db9027608582febfaaae7402becd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bb16f2bb3b7e291365d03f3fce133e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a3bb16f2bb3b7e291365d03f3fce133e5">buddy_free</a> (int index, void *ptr)</td></tr>
<tr class="separator:a3bb16f2bb3b7e291365d03f3fce133e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af40178e313133c421d349c79ba63b208"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#af40178e313133c421d349c79ba63b208">sw_buddy_print_state</a> (void)</td></tr>
<tr class="separator:af40178e313133c421d349c79ba63b208"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13df08b0dbc069ffb043f8caa1a69175"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a13df08b0dbc069ffb043f8caa1a69175">buddy_print_hk_state</a> (int index)</td></tr>
<tr class="separator:a13df08b0dbc069ffb043f8caa1a69175"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6f063fadf564f51c72ac39a83d9b550"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#ae6f063fadf564f51c72ac39a83d9b550">sw_malloc_private</a> (int heap_id, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="separator:ae6f063fadf564f51c72ac39a83d9b550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66652368e6d05f18bdc4be02b0c62694"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="separator:a66652368e6d05f18bdc4be02b0c62694"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9391919f96a3efd8e46306c8a62f27c4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a9391919f96a3efd8e46306c8a62f27c4">EXPORT_SYMBOL</a> (<a class="el" href="sw__buddy_8c.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>)</td></tr>
<tr class="separator:a9391919f96a3efd8e46306c8a62f27c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf62b1f83e5f1afcdd6342ad9a747b76"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#adf62b1f83e5f1afcdd6342ad9a747b76">sw_free_private</a> (int heap_id, void *pointer)</td></tr>
<tr class="separator:adf62b1f83e5f1afcdd6342ad9a747b76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18008f7ca319ae3bbe7c8cc24bbc7d4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a> (void *pointer)</td></tr>
<tr class="separator:a18008f7ca319ae3bbe7c8cc24bbc7d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe37dc40852f101531f3de6358155e67"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#afe37dc40852f101531f3de6358155e67">EXPORT_SYMBOL</a> (<a class="el" href="sw__buddy_8c.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>)</td></tr>
<tr class="separator:afe37dc40852f101531f3de6358155e67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6e76669dc3685687314edca3277d341"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#ab6e76669dc3685687314edca3277d341">sw_heap_init</a> (int index, void *<a class="el" href="sw__buddy_8h.html#a936aeca6c70ac3b4d5e4993539283e3e">heap_start</a>, unsigned int <a class="el" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a>)</td></tr>
<tr class="separator:ab6e76669dc3685687314edca3277d341"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d5ae0b70a151fe6e2f7ef47f63a20dd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a2d5ae0b70a151fe6e2f7ef47f63a20dd">alloc_private_heap</a> (int heap_id)</td></tr>
<tr class="separator:a2d5ae0b70a151fe6e2f7ef47f63a20dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49c8e60c1417de0f5d4599138b935517"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#a49c8e60c1417de0f5d4599138b935517">free_private_heap</a> (int heap_id)</td></tr>
<tr class="separator:a49c8e60c1417de0f5d4599138b935517"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdfbf958415e1dc5880f6038c09282f8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sw__buddy_8c.html#abdfbf958415e1dc5880f6038c09282f8">get_ptr_size</a> (void *ptr)</td></tr>
<tr class="memdesc:abdfbf958415e1dc5880f6038c09282f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">function to get the size of a pointer. This is needed during realloc  <a href="#abdfbf958415e1dc5880f6038c09282f8"></a><br/></td></tr>
<tr class="separator:abdfbf958415e1dc5880f6038c09282f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a152fc5203b90b1cff03b7b78579b8f52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _DEBUG&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00037">37</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad1e5ae50fc432ac8912714f90b07ad75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_POW_TWO</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x &amp;&amp; !(x &amp; (x - 1)))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00045">45</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>

</div>
</div>
<a class="anchor" id="a070d2ce7b6bb7e5c05602aa8c308d0c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NULL&#160;&#160;&#160;((void *)0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00034">34</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae35af79feeae0236e432622607a87c25"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OTZ_DPRINTK</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fmt, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00042">42</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a2d5ae0b70a151fe6e2f7ef47f63a20dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int alloc_private_heap </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>heap_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap_id</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00807">807</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> index;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0; index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a>; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == heap_id){</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span>(index=0; index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a>; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == -1){</div>
<div class="line">            h_index[index].heap_id = heap_id;</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: Heap allocation for task : %x failed \n&quot;</span>, heap_id);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3bb16f2bb3b7e291365d03f3fce133e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buddy_free </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td></td></tr>
    <tr><td class="paramname">ptr</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00550">550</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* FIXME: Handle the freeing of contiguously allocated nodes. */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__alloced__area.html">sw_alloced_area</a> *freed_node = search_for_allocated_block(index, ptr);</div>
<div class="line">    <span class="keywordflow">if</span> (!freed_node) {</div>
<div class="line">        <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;Bugger! No allocations found for address 0x%x\n&quot;</span>,</div>
<div class="line">                (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ptr);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;Freeing 0x%x of block size: 0x%x bin: 0x%x\n&quot;</span>,</div>
<div class="line">            (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ptr, freed_node-&gt;<a class="code" href="structsw__alloced__area.html#a211b58ca9925c56436d8c7378b6476a2">blk_sz</a>, freed_node-&gt;<a class="code" href="structsw__alloced__area.html#a8420d92aa57460317522543483fe45da">bin_num</a>);</div>
<div class="line">    return_to_pool(index, freed_node);</div>
<div class="line">    list_del(&amp;freed_node-&gt;<a class="code" href="structsw__alloced__area.html#aab1808f7bc0cecb86f5966ca44e9bb8e">head</a>);</div>
<div class="line">    <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(freed_node, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsw__alloced__area.html">sw_alloced_area</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac28cae12b6e530686c74ba708a365d13"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int buddy_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>heap_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>heap_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td></td></tr>
    <tr><td class="paramname">heap_start</td><td></td></tr>
    <tr><td class="paramname">heap_size</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00119">119</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> cntr = 0, tnodes = 0;</div>
<div class="line">    <span class="keywordtype">void</span> * <a class="code" href="sw__buddy_8h.html#a6173d4ae6cabbc095f530f2c31490d88">mem_start</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="sw__buddy_8h.html#a8fde73c7c6c82b6dbe7a8784df57ceda">mem_size</a>, hk_total_size;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__free__area.html">sw_free_area</a> * freenode = <a class="code" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* We manage heap space only in power of two */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="sw__buddy_8c.html#ad1e5ae50fc432ac8912714f90b07ad75">IS_POW_TWO</a>(<a class="code" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a>)) {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    hk_total_size = (<a class="code" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a> * <a class="code" href="sw__buddy_8h.html#a1e5ab3f6dc33ef6c5a84d39d42f3c6eb">HOUSE_KEEPING_PERCENT</a>) / 100;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* keep 4K of initial heap area for our housekeeping */</span></div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#a88852bd6fe7a12302ae5ed540424e98b">hk_fn_array</a> = (<span class="keyword">struct </span><a class="code" href="structsw__free__area.html">sw_free_area</a> *)<a class="code" href="sw__buddy_8h.html#a936aeca6c70ac3b4d5e4993539283e3e">heap_start</a>;</div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#abb07d40a7422ecff1008aae3507d386c">hk_fn_count</a> = (hk_total_size / 2) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsw__free__area.html">sw_free_area</a>);</div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#a07a637dada6d339931ee57af2d1f1a35">hk_an_array</a> = </div>
<div class="line">            (<span class="keyword">struct </span><a class="code" href="structsw__alloced__area.html">sw_alloced_area</a> *)(<a class="code" href="sw__buddy_8h.html#a936aeca6c70ac3b4d5e4993539283e3e">heap_start</a> + (hk_total_size / 2));</div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#a1a6be64aeae06a48f4b863431525258e">hk_an_count</a> = (hk_total_size / 2) / </div>
<div class="line">                    <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsw__alloced__area.html">sw_alloced_area</a>);</div>
<div class="line">    <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(buddy_heap[index].<a class="code" href="sw__buddy_8h.html#a32c4fb4cf12e41c0204aee4a7f20ff70">hk_fn_array</a>, 0, hk_total_size);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;buddy_heap[index].<a class="code" href="sw__buddy_8h.html#ad05441302211504d54462741b9a97b3a">current</a>.<a class="code" href="structsw__alloced__area.html#aab1808f7bc0cecb86f5966ca44e9bb8e">head</a>);</div>
<div class="line"></div>
<div class="line">    mem_start = <a class="code" href="sw__buddy_8h.html#a936aeca6c70ac3b4d5e4993539283e3e">heap_start</a> + hk_total_size;</div>
<div class="line">    mem_size = <a class="code" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a> - hk_total_size;</div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#a6988438d52ae2a64dffac865a91dd8dd">mem_start</a> = <a class="code" href="sw__buddy_8h.html#a6173d4ae6cabbc095f530f2c31490d88">mem_start</a>;</div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#ac8e0247a30021caa7d77ec038a245009">mem_size</a> = <a class="code" href="sw__buddy_8h.html#a8fde73c7c6c82b6dbe7a8784df57ceda">mem_size</a>;</div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#afc2f7c15f47ec77b2de5ee3e8a13cc7a">heap_start</a> = <a class="code" href="sw__buddy_8h.html#a936aeca6c70ac3b4d5e4993539283e3e">heap_start</a>;</div>
<div class="line">    buddy_heap[index].<a class="code" href="structsw__heap.html#a26b39b389f5cf9e87565dccc5f1f1a6c">heap_size</a> = <a class="code" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a>;</div>
<div class="line">    <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(&amp;buddy_heap[index].<a class="code" href="sw__buddy_8h.html#a40bdbfe29f1c61e10884d3afb56b5ec0">free_area</a>[0], 0, <span class="keyword">sizeof</span>(buddy_heap[index].free_area));</div>
<div class="line">    <span class="keywordflow">for</span> (cntr = 0; cntr &lt; <a class="code" href="sw__buddy_8h.html#aec7e23dc549857f8cade5732ff1b64f6">BINS_MAX_ORDER</a>; cntr++) {</div>
<div class="line">        <a class="code" href="sw__list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;buddy_heap[index].free_area[cntr].<a class="code" href="sw__buddy_8h.html#a97a56df9c26e733777ccbf0bcc1a1df2">head</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;buddy_heap[index].free_area[BINS_MAX_ORDER - 1].<a class="code" href="sw__buddy_8h.html#a97a56df9c26e733777ccbf0bcc1a1df2">head</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (mem_size &gt; 0) {</div>
<div class="line">        freenode = get_free_hk_node(index);</div>
<div class="line">        <span class="keywordflow">if</span> (!freenode) {</div>
<div class="line">            <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;no free node\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        freenode-&gt;<a class="code" href="structsw__free__area.html#a70393fc4a61a883b4923cbe684caa8ba">map</a> = <a class="code" href="sw__buddy_8h.html#a6173d4ae6cabbc095f530f2c31490d88">mem_start</a>;</div>
<div class="line">        mem_size -= <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a>;</div>
<div class="line">        mem_start += <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a>;</div>
<div class="line">        list_add_tail(&amp;buddy_heap[index].free_area[BINS_MAX_ORDER - 1].<a class="code" href="sw__buddy_8h.html#a97a56df9c26e733777ccbf0bcc1a1df2">head</a>,</div>
<div class="line">                  &amp;freenode-&gt;<a class="code" href="structsw__free__area.html#a548294b07a4e1bf0ac86475a882f864a">head</a>);</div>
<div class="line">        buddy_heap[index].<a class="code" href="structsw__heap.html#a04436ed0d4888b86365655a7ddc8d827">free_area</a>[BINS_MAX_ORDER - 1].<a class="code" href="structsw__free__area.html#abc4af1e2fb32409defd6f2cb2bef2c86">count</a>++;</div>
<div class="line">        tnodes++;</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;Total: 0x%x nodes of size 0x%x added to last bin.\n&quot;</span>,</div>
<div class="line">            tnodes, <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a13df08b0dbc069ffb043f8caa1a69175"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buddy_print_hk_state </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00614">614</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> <a class="code" href="libc__sos_8h.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a> = 0, idx;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__free__area.html">sw_free_area</a> *fren = buddy_heap[index].<a class="code" href="structsw__heap.html#a88852bd6fe7a12302ae5ed540424e98b">hk_fn_array</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__alloced__area.html">sw_alloced_area</a> *acn = buddy_heap[index].<a class="code" href="structsw__heap.html#a07a637dada6d339931ee57af2d1f1a35">hk_an_array</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; buddy_heap[index].<a class="code" href="structsw__heap.html#abb07d40a7422ecff1008aae3507d386c">hk_fn_count</a>; idx++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!fren-&gt;<a class="code" href="structsw__free__area.html#a70393fc4a61a883b4923cbe684caa8ba">map</a>) {</div>
<div class="line">            free++;</div>
<div class="line">        }</div>
<div class="line">        fren++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;Free Node List: 0x%x nodes free out of 0x%x.\n&quot;</span>, free,</div>
<div class="line">           buddy_heap[index].<a class="code" href="sw__buddy_8h.html#aa54ba428f7ccf53806d22e721263f0a3">hk_fn_count</a>);</div>
<div class="line"></div>
<div class="line">    free = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; buddy_heap[index].<a class="code" href="structsw__heap.html#a1a6be64aeae06a48f4b863431525258e">hk_an_count</a>; idx++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!acn-&gt;<a class="code" href="structsw__alloced__area.html#acf709712eb05301020077d3042f82d06">map</a>) {</div>
<div class="line">            free++;</div>
<div class="line">        }</div>
<div class="line">        acn++;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;Alloced Node List: 0x%x nodes free out of 0x%x.\n&quot;</span>, free,</div>
<div class="line">           buddy_heap[index].<a class="code" href="sw__buddy_8h.html#a0c28ffcd39f7f0b5b989870afa0a046a">hk_an_count</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af960db9027608582febfaaae7402becd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* buddy_zalloc </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00518">518</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> index, task_id = -1;</div>
<div class="line"></div>
<div class="line">    task_id = <a class="code" href="global_8c.html#a9746ce2989e67aaa21f36c4d524b487e" title="Returns the id of the current running task.">get_current_task_id</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0;index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a> ; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == task_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;No heap found for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> *ptr = <a class="code" href="sw__buddy_8h.html#a4d5bf0284b0f6760b507efa1141b88b7">sw_buddy_malloc</a>(index, size);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ptr) {</div>
<div class="line">        <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(ptr, 0, size);</div>
<div class="line">        h_index[index].num_blocks_alloc++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> ptr;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9391919f96a3efd8e46306c8a62f27c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT_SYMBOL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__buddy_8c.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="afe37dc40852f101531f3de6358155e67"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT_SYMBOL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__buddy_8c.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a49c8e60c1417de0f5d4599138b935517"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int free_private_heap </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>heap_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap_id</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00835">835</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> index;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0; index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a>; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == heap_id){</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW:  No heap available for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(h_index[index].num_blocks_alloc != 0){</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: Error : This heap not to be freed 0x%x and \</span></div>
<div class="line"><span class="stringliteral">            pending free 0x%x\n&quot;</span>, heap_id, h_index[index].num_blocks_alloc);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span>{</div>
<div class="line">        h_index[index].heap_id = -1;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abdfbf958415e1dc5880f6038c09282f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> get_ptr_size </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>function to get the size of a pointer. This is needed during realloc </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00868">868</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> task_id = -1;</div>
<div class="line">    <span class="keywordtype">int</span> index;</div>
<div class="line"></div>
<div class="line">    task_id = <a class="code" href="global_8c.html#a9746ce2989e67aaa21f36c4d524b487e" title="Returns the id of the current running task.">get_current_task_id</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0; index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a>; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == task_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;No heap found for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__alloced__area.html">sw_alloced_area</a> *node = search_for_allocated_block(index, ptr);</div>
<div class="line">        <span class="keywordflow">if</span>(node == <a class="code" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">                <span class="keywordflow">return</span>(0);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span>(node-&gt;<a class="code" href="structsw__alloced__area.html#a211b58ca9925c56436d8c7378b6476a2">blk_sz</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4d5bf0284b0f6760b507efa1141b88b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* sw_buddy_malloc </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td></td></tr>
    <tr><td class="paramname">size</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00447">447</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">    <span class="keywordtype">int</span> curr_blk = <a class="code" href="sw__buddy_8h.html#ac1f29ba54415975a2fa23e276fdf8a0f">MIN_BLOCK_SIZE</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__free__area.html">sw_free_area</a> *farea = <a class="code" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__alloced__area.html">sw_alloced_area</a> *aarea = <a class="code" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> bneeded;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &gt; buddy_heap[index].<a class="code" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a>) {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &gt; <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a>) {</div>
<div class="line">        bneeded =</div>
<div class="line">            (size %</div>
<div class="line">             <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a> ? ((size / <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a>) +</div>
<div class="line">                       1) : size / <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a>);</div>
<div class="line">        farea = buddy_get_contiguous_block(index, bneeded, <a class="code" href="sw__buddy_8h.html#aec7e23dc549857f8cade5732ff1b64f6">BINS_MAX_ORDER</a> - 1);</div>
<div class="line">        <span class="keywordflow">if</span> (farea) {</div>
<div class="line">            aarea = get_free_ac_node(index);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(!aarea) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#acb9537b905b9a7a0a22536c6e2ff2ceb">DIE_NOW</a>(0,</div>
<div class="line">                       <span class="stringliteral">&quot;Panic: No house keeping node available for buddy allocator.!\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            aarea-&gt;<a class="code" href="structsw__alloced__area.html#acf709712eb05301020077d3042f82d06">map</a> = farea-&gt;<a class="code" href="structsw__free__area.html#a70393fc4a61a883b4923cbe684caa8ba">map</a>;</div>
<div class="line">            aarea-&gt;<a class="code" href="structsw__alloced__area.html#a211b58ca9925c56436d8c7378b6476a2">blk_sz</a> = <a class="code" href="sw__buddy_8h.html#aa8bad2cd89820cdaf2a7f26392774014">MAX_BLOCK_SIZE</a> * bneeded;</div>
<div class="line">            aarea-&gt;<a class="code" href="structsw__alloced__area.html#a8420d92aa57460317522543483fe45da">bin_num</a> = <a class="code" href="sw__buddy_8h.html#aec7e23dc549857f8cade5732ff1b64f6">BINS_MAX_ORDER</a> - 1;</div>
<div class="line">            list_add_tail(&amp;buddy_heap[index].<a class="code" href="sw__buddy_8h.html#ad05441302211504d54462741b9a97b3a">current</a>.<a class="code" href="structsw__alloced__area.html#aab1808f7bc0cecb86f5966ca44e9bb8e">head</a>, &amp;aarea-&gt;<a class="code" href="structsw__alloced__area.html#aab1808f7bc0cecb86f5966ca44e9bb8e">head</a>);</div>
<div class="line">            buddy_heap[index].<a class="code" href="structsw__heap.html#ab2d7f0e1e1a2e10010d573e3330fbc40">current</a>.<a class="code" href="structsw__alloced__area.html#aa2becbbad89b8baa61454aa2d9a4271f">count</a>++;</div>
<div class="line">            free_hk_node(farea);</div>
<div class="line">            <span class="keywordflow">return</span> aarea-&gt;<a class="code" href="structsw__alloced__area.html#acf709712eb05301020077d3042f82d06">map</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt;= <a class="code" href="sw__buddy_8h.html#aec7e23dc549857f8cade5732ff1b64f6">BINS_MAX_ORDER</a>; idx++) {</div>
<div class="line">        <span class="keywordflow">if</span> (size &gt; curr_blk) {</div>
<div class="line">            curr_blk &lt;&lt;= 1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            farea = buddy_get_block(index, idx);</div>
<div class="line">            <span class="keywordflow">if</span> (farea) {</div>
<div class="line">                aarea = get_free_ac_node(index);</div>
<div class="line">                <span class="keywordflow">if</span> (!aarea) {</div>
<div class="line">                    <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;Bummer! No free alloc node?\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> <a class="code" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">                aarea-&gt;<a class="code" href="structsw__alloced__area.html#acf709712eb05301020077d3042f82d06">map</a> = farea-&gt;<a class="code" href="structsw__free__area.html#a70393fc4a61a883b4923cbe684caa8ba">map</a>;</div>
<div class="line">                aarea-&gt;<a class="code" href="structsw__alloced__area.html#a211b58ca9925c56436d8c7378b6476a2">blk_sz</a> = curr_blk;</div>
<div class="line">                aarea-&gt;<a class="code" href="structsw__alloced__area.html#a8420d92aa57460317522543483fe45da">bin_num</a> = idx;</div>
<div class="line">                <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(farea, 0,</div>
<div class="line">                       <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsw__free__area.html">sw_free_area</a>));</div>
<div class="line">                free_hk_node(farea);</div>
<div class="line">                list_add_tail(&amp;buddy_heap[index].<a class="code" href="sw__buddy_8h.html#ad05441302211504d54462741b9a97b3a">current</a>.<a class="code" href="structsw__alloced__area.html#aab1808f7bc0cecb86f5966ca44e9bb8e">head</a>,</div>
<div class="line">                          &amp;aarea-&gt;<a class="code" href="structsw__alloced__area.html#aab1808f7bc0cecb86f5966ca44e9bb8e">head</a>);</div>
<div class="line">                buddy_heap[index].<a class="code" href="structsw__heap.html#ab2d7f0e1e1a2e10010d573e3330fbc40">current</a>.<a class="code" href="structsw__alloced__area.html#aa2becbbad89b8baa61454aa2d9a4271f">count</a>++;</div>
<div class="line">                <span class="keywordflow">return</span> aarea-&gt;<a class="code" href="structsw__alloced__area.html#acf709712eb05301020077d3042f82d06">map</a>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="sw__buddy_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af40178e313133c421d349c79ba63b208"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sw_buddy_print_state </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00571">571</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__alloced__area.html">sw_alloced_area</a> *valloced;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *pos;</div>
<div class="line">    <span class="keywordtype">int</span> bfree = 0, balloced = 0;</div>
<div class="line">    <span class="keywordtype">int</span> index, task_id = -1;</div>
<div class="line"></div>
<div class="line">    task_id = <a class="code" href="global_8c.html#a9746ce2989e67aaa21f36c4d524b487e" title="Returns the id of the current running task.">get_current_task_id</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0;index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a> ; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == task_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;No heap found for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;Heap size: 0x%x KiB\n&quot;</span>, (buddy_heap[index].<a class="code" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a> / 1024));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="sw__buddy_8h.html#aec7e23dc549857f8cade5732ff1b64f6">BINS_MAX_ORDER</a>; idx++) {</div>
<div class="line">        <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;[BLOCK 0x%x]: &quot;</span>, <a class="code" href="sw__buddy_8h.html#ac1f29ba54415975a2fa23e276fdf8a0f">MIN_BLOCK_SIZE</a> &lt;&lt; idx);</div>
<div class="line">        <a class="code" href="sw__list_8h.html#abeae4779f478cbb5e1d437e6853c77c5">list_for_each</a>(pos, &amp;buddy_heap[index].<a class="code" href="sw__buddy_8h.html#a40bdbfe29f1c61e10884d3afb56b5ec0">free_area</a>[idx].<a class="code" href="sw__buddy_8h.html#a97a56df9c26e733777ccbf0bcc1a1df2">head</a>) {</div>
<div class="line">            bfree++;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="sw__list_8h.html#abeae4779f478cbb5e1d437e6853c77c5">list_for_each</a>(pos, &amp;buddy_heap[index].<a class="code" href="sw__buddy_8h.html#ad05441302211504d54462741b9a97b3a">current</a>.<a class="code" href="structsw__alloced__area.html#aab1808f7bc0cecb86f5966ca44e9bb8e">head</a>) {</div>
<div class="line">            valloced =</div>
<div class="line">                <a class="code" href="sw__list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(pos, <span class="keyword">struct</span> <a class="code" href="structsw__alloced__area.html">sw_alloced_area</a>, <a class="code" href="sw__buddy_8h.html#a97a56df9c26e733777ccbf0bcc1a1df2">head</a>);</div>
<div class="line">            <span class="keywordflow">if</span> (valloced-&gt;<a class="code" href="structsw__alloced__area.html#a8420d92aa57460317522543483fe45da">bin_num</a> == idx) {</div>
<div class="line">                balloced++;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="sw__buddy_8c.html#ae35af79feeae0236e432622607a87c25">OTZ_DPRINTK</a>(<span class="stringliteral">&quot;0x%x alloced, 0x%x free block(s)\n&quot;</span>, balloced, bfree);</div>
<div class="line">        bfree = 0;</div>
<div class="line">        balloced = 0;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a18008f7ca319ae3bbe7c8cc24bbc7d4b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sw_free </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pointer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pointer</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00751">751</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> task_id = -1;</div>
<div class="line">    <span class="keywordtype">int</span> index;</div>
<div class="line"></div>
<div class="line">    task_id = <a class="code" href="global_8c.html#a9746ce2989e67aaa21f36c4d524b487e" title="Returns the id of the current running task.">get_current_task_id</a>();  </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0; index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a>; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == task_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: No heap found for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>; </div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: free : %x \n&quot;</span>, index);</div>
<div class="line">    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: addr 0x%08x  \n&quot;</span>, (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)pointer);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__buddy_8h.html#a3bb16f2bb3b7e291365d03f3fce133e5">buddy_free</a>(index, pointer);</div>
<div class="line">    h_index[index].num_blocks_alloc--;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: heap free 0x%x and pending alloc 0x%x\n&quot;</span>,</div>
<div class="line">        task_id, h_index[index].num_blocks_alloc);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adf62b1f83e5f1afcdd6342ad9a747b76"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sw_free_private </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>heap_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pointer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap_id</td><td></td></tr>
    <tr><td class="paramname">pointer</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00723">723</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line"> {</div>
<div class="line">    <span class="keywordtype">int</span> index;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0; index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a>; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == heap_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: No heap found for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__buddy_8h.html#a3bb16f2bb3b7e291365d03f3fce133e5">buddy_free</a>(index, pointer);</div>
<div class="line">    h_index[index].num_blocks_alloc--;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: heap free 0x%x and pending alloc 0x%x\n&quot;</span>,</div>
<div class="line">        heap_id, h_index[index].num_blocks_alloc);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab6e76669dc3685687314edca3277d341"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sw_heap_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>heap_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>heap_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td></td></tr>
    <tr><td class="paramname">heap_start</td><td></td></tr>
    <tr><td class="paramname">heap_size</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00792">792</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    h_index[index].heap_id = -1;</div>
<div class="line">    h_index[index].num_blocks_alloc = 0;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="sw__buddy_8h.html#ac28cae12b6e530686c74ba708a365d13">buddy_init</a>(index, <a class="code" href="sw__buddy_8h.html#a936aeca6c70ac3b4d5e4993539283e3e">heap_start</a>, <a class="code" href="sw__buddy_8h.html#a58becee4da1c264266e29bfb43a452a4">heap_size</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a66652368e6d05f18bdc4be02b0c62694"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* sw_malloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00682">682</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> addr;</div>
<div class="line">    <span class="keywordtype">int</span> task_id = -1;</div>
<div class="line">    <span class="keywordtype">int</span> index;</div>
<div class="line"></div>
<div class="line">    task_id = <a class="code" href="global_8c.html#a9746ce2989e67aaa21f36c4d524b487e" title="Returns the id of the current running task.">get_current_task_id</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0;index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a> ; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == task_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: No heap found for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: alloc : %x \n&quot;</span>, index);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    addr = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="sw__buddy_8h.html#a4d5bf0284b0f6760b507efa1141b88b7">sw_buddy_malloc</a>(index, size);</div>
<div class="line">    <span class="keywordflow">if</span>(addr &gt; 0)</div>
<div class="line">        h_index[index].num_blocks_alloc++;</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: addr 0x%08x size %x \n&quot;</span>, addr, size);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: heap alloc 0x%x and pending alloc 0x%x\n&quot;</span>,</div>
<div class="line">        task_id, h_index[index].num_blocks_alloc);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)addr;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae6f063fadf564f51c72ac39a83d9b550"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* sw_malloc_private </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>heap_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap_id</td><td></td></tr>
    <tr><td class="paramname">size</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="sw__buddy_8c_source.html#l00649">649</a> of file <a class="el" href="sw__buddy_8c_source.html">sw_buddy.c</a>.</p>
<div class="fragment"><div class="line">{ </div>
<div class="line">    <span class="keywordtype">int</span> index;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> addr;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(index=0;index &lt; <a class="code" href="sw__buddy_8h.html#a2b25c49f73507c6fd8df6db198abb54c">NUM_OF_HEAPS</a> ; index++){</div>
<div class="line">        <span class="keywordflow">if</span>(h_index[index].heap_id == heap_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(index == NUM_OF_HEAPS){</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: No heap found for this task\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    addr =  (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="sw__buddy_8h.html#a4d5bf0284b0f6760b507efa1141b88b7">sw_buddy_malloc</a>(index, size);</div>
<div class="line">    <span class="keywordflow">if</span>(addr &gt; 0)</div>
<div class="line">        h_index[index].num_blocks_alloc++;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: heap alloc 0x%x and pending alloc 0x%x\n&quot;</span>,</div>
<div class="line">        heap_id, h_index[index].num_blocks_alloc);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)addr;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 3 2013 00:33:53 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
